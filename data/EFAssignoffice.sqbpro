<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="EFAssign.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="1"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="4020"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><table title="survey" custom_title="0" dock_id="1" table="4,6:mainsurvey"/><dock_state state="000000ff00000000fd0000000100000002000007d600000603fc0100000001fb000000160064006f0063006b00420072006f00770073006500310100000000000007d60000019c00ffffff0000074a0000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="assignments" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="93"/><column index="2" value="72"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="demand" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="93"/><column index="2" value="50"/><column index="3" value="85"/><column index="4" value="82"/><column index="5" value="44"/><column index="6" value="75"/><column index="7" value="61"/><column index="8" value="63"/><column index="9" value="63"/><column index="10" value="61"/><column index="11" value="63"/><column index="12" value="64"/><column index="13" value="64"/><column index="14" value="64"/><column index="15" value="55"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="meta_filters" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="156"/><column index="2" value="176"/><column index="3" value="99"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="studentpreferences" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="93"/><column index="2" value="85"/><column index="3" value="82"/><column index="4" value="44"/><column index="5" value="75"/><column index="6" value="77"/><column index="7" value="67"/><column index="8" value="108"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="survey" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="93"/><column index="2" value="92"/><column index="3" value="50"/><column index="4" value="85"/><column index="5" value="82"/><column index="6" value="44"/><column index="7" value="75"/><column index="8" value="65"/><column index="9" value="67"/><column index="10" value="68"/><column index="11" value="66"/><column index="12" value="68"/><column index="13" value="68"/><column index="14" value="69"/><column index="15" value="69"/><column index="16" value="73"/><column index="17" value="76"/><column index="18" value="75"/><column index="19" value="76"/><column index="20" value="76"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1*">-- Drop the studentpreferences table if it exists
DROP TABLE IF EXISTS student_choices;

-- Create the studentpreferences table
CREATE TABLE student_choices (
  student_id TEXT NOT NULL,
  firstName TEXT,
  lastName TEXT,
  program TEXT,
  level TEXT,
  weekday TEXT,
  ranking INTEGER,
  course_code TEXT
);

-- Create studentpreferences directly from survey
WITH student_data AS (
  SELECT
    student_id,
    firstName,
    lastName,
    level,
    -- Determine the program type
    CASE WHEN instr(program, 'Intensive') THEN 'Intensive' ELSE 'General' END AS program,
    -- Adjust Mon and Wed columns based on the program type
    CASE WHEN instr(program, 'Intensive') THEN IMon01 ELSE '' END AS Mon01,
    CASE WHEN instr(program, 'Intensive') THEN IMon02 ELSE '' END AS Mon02,
    CASE WHEN instr(program, 'Intensive') THEN IMon03 ELSE '' END AS Mon03,
    CASE WHEN instr(program, 'Intensive') THEN IWed01 ELSE GWed01 END AS Wed01,
    CASE WHEN instr(program, 'Intensive') THEN IWed02 ELSE GWed02 END AS Wed02,
    CASE WHEN instr(program, 'Intensive') THEN IWed03 ELSE GWed03 END AS Wed03,
    CASE WHEN instr(program, 'Intensive') THEN IWed04 ELSE GWed04 END AS Wed04,
    CASE WHEN instr(program, 'Intensive') THEN IWed05 ELSE GWed05 END AS Wed05
  FROM survey
)

INSERT INTO studentpreferences (student_id, firstName, lastName, program, level, weekday, ranking, course_code)
-- Mon01 Preferences
SELECT
  student_id,
  firstName,
  lastName,
  program,
  level,
  'Mon01' AS weekday,
  1 AS ranking,
  substr(Mon01, instr(Mon01, '_') + 1) AS course_code
FROM student_data
WHERE Mon01 != ''

UNION ALL

-- Mon02 Preferences
SELECT
  student_id,
  firstName,
  lastName,
  program,
  level,
  'Mon02',
  2,
  substr(Mon02, instr(Mon02, '_') + 1)
FROM student_data
WHERE Mon02 != ''

UNION ALL

-- Mon03 Preferences
SELECT
  student_id,
  firstName,
  lastName,
  program,
  level,
  'Mon03',
  3,
  substr(Mon03, instr(Mon03, '_') + 1)
FROM student_data
WHERE Mon03 != ''

UNION ALL

-- Wed01 Preferences
SELECT
  student_id,
  firstName,
  lastName,
  program,
  level,
  'Wed01',
  1,
  substr(Wed01, instr(Wed01, '_') + 1)
FROM student_data
WHERE Wed01 != ''

UNION ALL

-- Wed02 Preferences
SELECT
  student_id,
  firstName,
  lastName,
  program,
  level,
  'Wed02',
  2,
  substr(Wed02, instr(Wed02, '_') + 1)
FROM student_data
WHERE Wed02 != ''

UNION ALL

-- Wed03 Preferences
SELECT
  student_id,
  firstName,
  lastName,
  program,
  level,
  'Wed03',
  3,
  substr(Wed03, instr(Wed03, '_') + 1)
FROM student_data
WHERE Wed03 != ''

UNION ALL

-- Wed04 Preferences
SELECT
  student_id,
  firstName,
  lastName,
  program,
  level,
  'Wed04',
  4,
  substr(Wed04, instr(Wed04, '_') + 1)
FROM student_data
WHERE Wed04 != ''

UNION ALL

-- Wed05 Preferences
SELECT
  student_id,
  firstName,
  lastName,
  program,
  level,
  'Wed05',
  5,
  substr(Wed05, instr(Wed05, '_') + 1)
FROM student_data
WHERE Wed05 != '';</sql><current_tab id="0"/></tab_sql></sqlb_project>
